import java.util.Arrays;

public class LogisticRegression {
    public static double dotProduct(double[] arr1, double[] arr2) {
        double result = 0;
        for (int i = 0; i < arr1.length; i++) {
            result += arr1[i] * arr2[i];
        }
        return result;
    }

    public double[] initializeParameters(int num, double fillValue) {
        double[] parameters = new double[num];
        if (fillValue >= 0) {
            Arrays.fill(parameters, fillValue);
        } else {
            for (int i = 0; i < num; i++) {
                parameters[i] = Math.random();
            }
        }
        return parameters;
    }

    public double sigmoid(double num) {
        return 1 / (1 + Math.exp(-num));
    }

    public double prediction(double[] weights, double bias, double[] data) {
        return sigmoid(dotProduct(weights, data) + bias);
    }

    public double meanSquaredError(double y, double yHat) {
        return (y - yHat) * (y - yHat);
    }

    public double logarithmicError(double y, double yHat) {
        return y * Math.log(yHat) + (1 - y) * Math.log(1 - yHat);
    }

    public double logarithmicLoss(double[] weights, double bias, double[][] dataSet, double[] results) {
        double sum = 0;
        for (int i = 0; i < dataSet.length; i++) {
            double[] data = dataSet[i];
            double yHat = prediction(weights, bias, data);
//            System.out.println("Prediction " + Double.toString(yHat));
            double y = results[i];
            sum += logarithmicError(y, yHat);
        }
        return -1 / (double)dataSet.length * sum;
    }

    public double learn(double[] weights, double bias, double[][] dataSet, double[] results, double delta, double learningRate) {
        double[] weightGradients = new double[weights.length];
        double biasGradient;
        for (int i = 0; i < weights.length; i++) {
            double currentError = logarithmicLoss(weights, bias, dataSet, results);
            weights[i] += delta;
            double deltaError = currentError - logarithmicLoss(weights, bias, dataSet, results);
            weights[i] -= delta;
            double slope = deltaError/delta;
            weightGradients[i] = slope;
        }
        double deltaError = logarithmicLoss(weights, bias, dataSet, results) - logarithmicLoss(weights, bias + delta, dataSet, results);
        double slope = deltaError/delta;
        biasGradient = slope;

        for (int i = 0; i < weights.length; i++) {
            weights[i] += learningRate * weightGradients[i];
        }
        bias += learningRate * biasGradient;
        return bias;
    }

    public int testPredictions(double[] weights, double bias, double[][] dataSet, double[] results) {
        int numCorrect = 0;
        for (int i = 0; i < dataSet.length; i++) {
            double[] data = dataSet[i];
            if (Math.abs(results[i] - prediction(weights, bias, data)) < 0.5) {
                numCorrect++;
            }
        }
        return numCorrect;
    }

    public static void main(String[]args) {
        // width, mass

//        for (int i = 0; i < 100; i++) {
//            System.out.print("{");
//            System.out.print(5 * Math.random() + 5);
//            System.out.print(", ");
//            System.out.print(10 * Math.random() + 10);
//            System.out.println("},");
//        }
//
//        for (int i = 0; i < 100; i++) {
//            System.out.print("{");
//            System.out.print(3 * Math.random() + 1);
//            System.out.print(", ");
//            System.out.print(10 * Math.random());
//            System.out.println("},");
//        }



        double[][] trainingData = {
                {8.340095465508313, 11.350212431357235},
                {6.852802930656179, 10.684675268193843},
                {7.666960847998285, 15.523440828546992},
                {7.85715701182014, 12.024017146476517},
                {8.419143606573328, 16.58334198590293},
                {6.826336435242641, 17.97605517532524},
                {6.074773902391737, 13.917729386195187},
                {9.199099156890489, 14.12029560759013},
                {6.36226548824364, 12.233186815627683},
                {6.377850594841529, 19.522424727248634},
                {5.76472642027949, 16.943940818801714},
                {7.336134351739424, 11.535949991014334},
                {5.643837868911335, 11.313592166929968},
                {5.915977746656174, 17.528974253235518},
                {9.105663230128759, 18.099041809285467},
                {7.295469487298722, 13.946569010580902},
                {7.548241709146453, 15.09632682144484},
                {8.752453163601258, 13.67584273273236},
                {5.554446660880375, 10.950976720145738},
                {7.901981932656773, 18.549952067740307},
                {8.42347493073726, 14.87089066300285},
                {6.043182189522041, 15.008936196665928},
                {6.170465013989153, 11.467627303369214},
                {5.1154364756832695, 17.42939915407326},
                {6.266126195147808, 19.852389638149248},
                {9.034301305065604, 15.441705733613167},
                {9.736891011213402, 14.325873642100838},
                {8.854334342715454, 18.6724945554296},
                {6.500989313720216, 12.52654851540587},
                {6.289011865744968, 14.781953540927406},
                {5.976972335738781, 15.739819520824298},
                {6.607177779278691, 14.409447526500632},
                {8.068599857726554, 15.220916686526646},
                {9.820969891723351, 19.6977214910741},
                {7.603635210755231, 17.847247097178474},
                {8.381930116161886, 11.435049118570213},
                {7.183976002036484, 14.191333913156246},
                {5.310011582182003, 13.536333558994306},
                {9.190681978232192, 12.193359527301357},
                {8.794452679405035, 12.578311234977159},
                {7.379843196101659, 10.012718340194404},
                {7.825997598522761, 14.410646357231688},
                {7.103864329815977, 12.35087798244971},
                {8.346700219405868, 19.48384761857494},
                {5.6976260743804525, 15.563236750235422},
                {5.736554708934556, 13.46657711298448},
                {5.9801132643532355, 18.215552975384725},
                {7.195455882426754, 19.96906232418051},
                {6.139487013639504, 15.390921541053824},
                {6.72449906792084, 17.745966090533006},
                {8.493206865170837, 17.016151591394532},
                {5.962387064432693, 15.621203219629916},
                {7.744693668921471, 12.75179775326689},
                {6.090720207604889, 14.558840185501031},
                {6.3941576049154465, 18.577988663576644},
                {9.386202835265436, 17.798349868228662},
                {5.903595901443848, 13.108579489244441},
                {8.768307518465448, 16.77913774913954},
                {7.064600010312801, 14.879056260188044},
                {9.867695427924568, 12.698392218627358},
                {6.772494392965337, 15.379000764030176},
                {7.723701313804823, 10.977957718306717},
                {6.071459984868037, 16.43782123731956},
                {9.208445698649594, 18.660065059068025},
                {5.902681471643347, 14.722843631117733},
                {7.67064865372705, 12.808395866047592},
                {7.4611870316490085, 10.571748279440204},
                {8.093974493780369, 11.360101293048416},
                {8.446934991055887, 13.156724377014923},
                {9.272745389628907, 16.55603013086},
                {9.781831158461669, 19.06561438127208},
                {9.122121058435674, 15.070566683669679},
                {9.556747910826903, 16.785699509852172},
                {5.260346355867825, 18.269118957137433},
                {7.071244627225295, 15.288675695314405},
                {5.427430236722768, 10.640435174907005},
                {9.833573638217352, 10.940759115996947},
                {6.137624312792704, 14.38257199717217},
                {5.299690963155954, 13.299748302634649},
                {8.202328518183553, 13.365472577969221},
                {6.947368400763659, 17.011262678913525},
                {9.405558859996539, 10.249760310958989},
                {6.005142167876971, 13.979267780053151},
                {7.665870791948855, 16.410487209446316},
                {5.785712683729714, 17.261386498851763},
                {7.476637153322633, 15.496223849560913},
                {5.109543832602869, 15.727388599798482},
                {8.280840657274227, 17.948010873568307},
                {5.746792443660506, 16.41964026629583},
                {5.707046862172388, 15.609341197608847},
                {6.154332709047131, 19.76718473298706},
                {5.269981495315866, 12.677473469140207},
                {5.039521349492574, 11.330519171041756},
                {8.222143461416726, 11.678025693690149},
                {8.443484161773187, 12.592018080939766},
                {5.732144689845845, 10.888933942924284},
                {8.104085246797137, 12.45735155852633},
                {5.460972480723652, 12.696505081088333},
                {6.832374171397657, 10.596130666765198},
                {8.909131717477523, 10.735427815296266},
                {3.109714259132315, 3.525405162514982},
                {3.1693768139758522, 7.3462539485295455},
                {1.6904405015092299, 4.4275310110184165},
                {1.8424087124178783, 1.8779966076499222},
                {1.5929783599843383, 8.094314533474313},
                {2.434737688397826, 4.67013559185741},
                {3.698789554066585, 3.102229208254518},
                {3.6410279834238577, 1.1674602169405668},
                {2.3986710690058852, 4.348893511300842},
                {3.257377960442975, 5.552819948588631},
                {1.5395273690858915, 0.4188900106988136},
                {1.7155687906100492, 3.5269946611154346},
                {2.493199845030157, 1.897392157981962},
                {1.3907830131820733, 9.421536992985777},
                {3.436069722122059, 8.712961639602565},
                {3.7300058212479885, 3.699577954455041},
                {2.8060768442617694, 6.866263712494174},
                {1.4231220620000244, 3.0812311260125904},
                {1.1254797397209757, 7.489344936640309},
                {3.8572811356884817, 7.024367505148952},
                {1.943110096867237, 4.080502399124954},
                {1.9574035131752923, 1.0981766183604402},
                {3.559054787503716, 6.972666908911236},
                {1.2217582251288273, 9.906069186426855},
                {2.4476289941600897, 7.618615490854914},
                {1.3113456678139221, 9.64611628815003},
                {3.8911828587235187, 9.114215307779382},
                {3.945375136382746, 3.1413628891786805},
                {3.277713742499274, 3.5312909805272827},
                {2.092429311982813, 8.228990102513695},
                {3.7994369403598283, 1.0946053731667094},
                {3.5279651546871342, 3.7664471660762544},
                {3.9173962160211953, 1.0128240379239195},
                {2.753603304818067, 6.194309998703741},
                {3.928875397954705, 8.861233371877033},
                {1.0422135467556333, 3.5897630812644685},
                {1.2898026466350108, 0.8143657661432735},
                {3.9851098172117814, 3.451248880530841},
                {2.0035180408981983, 0.7395838147339584},
                {2.373719235092732, 5.073961142233135},
                {3.390205069311476, 2.18805467868469},
                {1.5478997740595788, 7.307502991504396},
                {1.8979661105336718, 3.6574519101507352},
                {2.4866303304614954, 7.731175376745235},
                {3.3069518940397247, 2.1510947831634963},
                {3.904105711465769, 9.838991075624714},
                {1.7121349363682614, 7.0211431470261685},
                {3.445322013539027, 0.6956643336134027},
                {2.0482452600897574, 3.3588425557064117},
                {2.750041908984447, 2.706453476006583},
                {1.6420684638843506, 1.7827131292064635},
                {3.6725860279288787, 9.637883591740987},
                {1.3427343146092379, 9.3759651273298},
                {2.3071997459009084, 8.833013017662243},
                {1.1898037510367319, 4.737309777924521},
                {1.6747994932535608, 8.684049630725351},
                {2.331893479352086, 8.634732636902566},
                {3.976708119279938, 2.8567603030826296},
                {1.0052545698761142, 0.5896803539043272},
                {1.2145430828073192, 0.5052625531661736},
                {1.8221536629251607, 0.8695061034207141},
                {2.7127259563639337, 4.772425192439107},
                {1.4030829926946073, 6.8289074271987085},
                {2.661136296844083, 0.2402435631687061},
                {2.5147561752545187, 2.3164845917592625},
                {1.22023762017233, 3.676199853759401},
                {2.3475272721193967, 8.950432297640388},
                {1.9995590042628177, 1.4157558087718214},
                {3.3812970557883806, 8.46777369518078},
                {3.832718084423087, 1.027770163010917},
                {1.4481551851228847, 6.064433644759096},
                {1.7282283919249142, 4.5287660574127555},
                {3.1029312368621644, 5.6688379911791245},
                {3.675137849613258, 5.3436252352877345},
                {2.259511485651635, 9.429619686527255},
                {2.6260988179852216, 1.4544145455596624},
                {2.241205483088507, 5.348398674373821},
                {1.4677761974635217, 2.735701643517036},
                {3.9276276747175034, 8.951497527967671},
                {3.119554937817149, 1.3438502481064696},
                {2.5584878071135315, 7.16984148172523},
                {2.0763107662586786, 0.2094274120154782},
                {3.976364140813022, 5.184184610002475},
                {3.729565800079123, 6.175999579213415},
                {2.6559635766515584, 9.89319514521047},
                {1.6636529160069211, 1.1352285252931649},
                {1.7765516501486172, 6.874819904606468},
                {2.8295686051221853, 6.627325993705146},
                {1.8471655884564115, 1.2367433265618932},
                {3.0489979164817393, 4.80755909062802},
                {2.990902798367289, 6.5896423743473145},
                {3.6945515890736296, 1.4236464890530354},
                {3.935008033568891, 0.5273337709809123},
                {1.629557348357293, 4.505519012395291},
                {2.0376603808825693, 9.460796354032507},
                {2.5718043905203234, 5.838065829814841},
                {1.3102924565130003, 0.4284454737606602},
                {1.9704442480678073, 0.9691209872272577},
                {1.3659530029227551, 2.592925635598491},
                {3.2538044020017223, 7.4990920358667665},
                //                {8, 12},
 //               {6, 11},
  //              {5, 17},
   //             {1, 5},
    //            {3, 7},
     //           {6, 1}
        };

        double[] positive = new double[100];
        Arrays.fill(positive, 1);
        double[] negative = new double[100];
        Arrays.fill(negative, 0);
        double[] results = new double[200];

        for (int i = 0; i < 100; i++) {
            results[i] = positive[i];
        }
        for (int i = 0; i < 100; i++) {
            results[i + 100] = negative[i];
        }

        LogisticRegression classifier = new LogisticRegression();
        double[] parameters = classifier.initializeParameters(trainingData[0].length, -1);
        double bias = 0.0;
        System.out.println(classifier.testPredictions(parameters, bias, trainingData, results));

        for (int i = 0; i < 10000; i++) {
            bias = classifier.learn(parameters, bias, trainingData, results, 0.001, 0.01);
        }
        System.out.println(classifier.testPredictions(parameters, bias, trainingData, results));
        System.out.println(Arrays.toString(parameters));
        System.out.println(classifier.logarithmicLoss(parameters, bias, trainingData, results));
        System.out.println(bias);


    }

}
